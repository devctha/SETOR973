<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>SV.APP — Apêndices (Aurora de Vidro)</title>

  <style>
    :root{
      --bg:#07070a;
      --bg2:#050508;
      --card:rgba(255,255,255,.05);
      --card2:rgba(255,255,255,.075);
      --line:rgba(255,255,255,.10);
      --muted:rgba(255,255,255,.65);
      --text:rgba(255,255,255,.92);

      --gold:#AD974F;
      --gold2:#8E793E;
      --gold3:#E7D7A6;

      --ok:#36d399;
      --warn:#ffcc66;
      --bad:#ff4d6d;

      --radius:16px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 12px 30px rgba(0,0,0,.55);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(173,151,79,.10), transparent 60%),
        radial-gradient(900px 500px at 80% 10%, rgba(142,121,62,.10), transparent 60%),
        radial-gradient(900px 600px at 50% 100%, rgba(255,255,255,.05), transparent 70%),
        linear-gradient(180deg, var(--bg2), var(--bg) 40%, #06060a);
      overflow-x:hidden;
    }

    a{ color:inherit; text-decoration:none; }
    button, input { font:inherit; }

    .app{
      min-height:100vh;
      display:grid;
      grid-template-columns: 290px 1fr 420px;
      gap: 14px;
      padding: 16px;
      align-items:start;
    }

    /* Sidebar */
    .side{
      position: sticky;
      top: 16px;
      align-self:start;
      height: calc(100vh - 32px);
      border: 1px solid var(--line);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow2);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .side .hd{
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .sigil{
      width: 36px;
      height: 36px;
      border-radius: 12px;
      position:relative;
      background:
        radial-gradient(circle at 35% 35%, rgba(231,215,166,.35), transparent 55%),
        linear-gradient(135deg, rgba(173,151,79,.35), rgba(142,121,62,.15));
      border: 1px solid rgba(231,215,166,.35);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .sigil:before{
      content:"";
      position:absolute;
      inset:-18px;
      background:
        conic-gradient(from 180deg,
          rgba(231,215,166,.0),
          rgba(231,215,166,.35),
          rgba(231,215,166,.0),
          rgba(173,151,79,.0),
          rgba(173,151,79,.30),
          rgba(173,151,79,.0)
        );
      animation: spin 8s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg);} }

    .brand .ttl{
      min-width:0;
    }
    .brand h1{
      margin:0;
      font-size: 12px;
      letter-spacing:.09em;
      text-transform:uppercase;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand small{
      display:block;
      margin-top:4px;
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted);
      letter-spacing:.04em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .iconbtn{
      width: 38px;
      height: 38px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      cursor:pointer;
      transition:.15s ease;
      display:grid;
      place-items:center;
      color: rgba(231,215,166,.95);
      font-family: var(--mono);
      font-size: 12px;
      flex: 0 0 auto;
    }
    .iconbtn:hover{
      border-color: rgba(231,215,166,.28);
      background: rgba(173,151,79,.10);
    }

    .side .nav{
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:auto;
    }

    .nav a{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid transparent;
      color: rgba(255,255,255,.82);
      transition:.15s ease;
      user-select:none;
    }
    .nav a:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.08);
    }
    .nav a.active{
      background: linear-gradient(180deg, rgba(173,151,79,.14), rgba(255,255,255,.02));
      border-color: rgba(173,151,79,.30);
      color: rgba(255,255,255,.92);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(173,151,79,.25);
      background: rgba(173,151,79,.08);
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.02em;
      color: rgba(231,215,166,.95);
      white-space:nowrap;
    }
    .dot{
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--ok);
      box-shadow: 0 0 0 6px rgba(54,211,153,.08);
    }

    .side .ft{
      margin-top:auto;
      border-top: 1px solid rgba(255,255,255,.08);
      padding: 12px;
      background: rgba(255,255,255,.02);
    }

    .mono{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.80);
      line-height: 1.6;
    }
    .dim{ color: rgba(255,255,255,.55); }

    /* Center */
    .center{
      border: 1px solid var(--line);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: calc(100vh - 32px);
      display:flex;
      flex-direction:column;
    }

    .topbar{
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(900px 240px at 12% 0%, rgba(173,151,79,.18), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(255,255,255,.02));
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .title h2{
      margin:0;
      font-size: 15px;
      letter-spacing:.09em;
      text-transform:uppercase;
    }
    .subtitle{
      margin-top: 6px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.72);
      line-height: 1.4;
    }

    .controls{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .search{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      min-width: min(460px, 78vw);
      box-shadow: var(--shadow2);
    }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background: transparent;
      color: rgba(255,255,255,.92);
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing:.02em;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.65);
      padding: 4px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }

    .chipbar{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      background: rgba(255,255,255,.02);
    }

    .chips{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      align-items:center;
    }

    .chip{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.78);
      padding: 8px 10px;
      border-radius: 999px;
      cursor:pointer;
      font-family: var(--mono);
      font-size: 12px;
      transition: .15s ease;
      user-select:none;
    }
    .chip:hover{
      border-color: rgba(231,215,166,.25);
      background: rgba(173,151,79,.08);
    }
    .chip.active{
      border-color: rgba(173,151,79,.35);
      background: rgba(173,151,79,.10);
      color: rgba(231,215,166,.95);
    }

    .btn{
      border: 1px solid rgba(173,151,79,.28);
      background: rgba(173,151,79,.10);
      color: rgba(231,215,166,.95);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      transition:.15s ease;
      font-family: var(--mono);
      font-size: 12px;
      user-select:none;
    }
    .btn:hover{
      border-color: rgba(231,215,166,.45);
      background: rgba(173,151,79,.14);
    }
    .btn.ghost{
      border-color: rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.78);
    }

    .list{
      padding: 12px 14px 18px;
      overflow:auto;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      align-content:start;
    }

    .item{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 220px at 10% 0%, rgba(173,151,79,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.10));
      padding: 12px;
      box-shadow: var(--shadow2);
      cursor:pointer;
      transition:.15s ease;
      position:relative;
      overflow:hidden;
      min-height: 132px;
    }
    .item:hover{
      transform: translateY(-1px);
      border-color: rgba(231,215,166,.25);
    }
    .item.active{
      outline: 2px solid rgba(173,151,79,.35);
    }

    .row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .badge{
      font-family: var(--mono);
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.76);
      white-space:nowrap;
    }
    .badge.gold{
      border-color: rgba(173,151,79,.30);
      background: rgba(173,151,79,.10);
      color: rgba(231,215,166,.95);
    }
    .badge.ok{ border-color: rgba(54,211,153,.35); background: rgba(54,211,153,.08); color: rgba(200,255,235,.95); }
    .badge.warn{ border-color: rgba(255,204,102,.35); background: rgba(255,204,102,.08); color: rgba(255,244,210,.95); }
    .badge.bad{ border-color: rgba(255,77,109,.35); background: rgba(255,77,109,.08); color: rgba(255,210,218,.95); }

    .item h3{
      margin: 0 0 6px;
      font-size: 13px;
      letter-spacing:.06em;
    }
    .item p{
      margin:0;
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.55;
      color: rgba(255,255,255,.72);
    }

    /* Right preview */
    .right{
      position: sticky;
      top: 16px;
      align-self:start;
      height: calc(100vh - 32px);
      border: 1px solid var(--line);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .preview-hd{
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(900px 240px at 15% 0%, rgba(173,151,79,.18), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(255,255,255,.02));
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .preview-hd h3{
      margin:0;
      font-size: 13px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }

    .preview{
      padding: 12px 14px 16px;
      overflow:auto;
      flex: 1;
    }

    .box{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding: 12px;
      margin-bottom: 12px;
    }
    .box h4{
      margin:0 0 8px;
      font-size: 12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: rgba(231,215,166,.95);
    }

    .terminal{
      border-radius: 16px;
      border: 1px solid rgba(173,151,79,.25);
      background: rgba(0,0,0,.28);
      padding: 12px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(231,215,166,.92);
      white-space: pre-wrap;
      max-height: 320px;
      overflow:auto;
    }

    .preview-actions{
      padding: 12px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .toast{
      position: fixed;
      left: 16px;
      bottom: 16px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow2);
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.82);
      opacity: 0;
      transform: translateY(6px);
      pointer-events:none;
      transition: .18s ease;
      max-width: min(560px, 92vw);
    }
    .toast.show{
      opacity: 1;
      transform: translateY(0);
    }

    /* Responsive */
    @media (max-width: 1100px){
      .app{
        grid-template-columns: 1fr;
      }
      .side, .right{
        position: relative;
        top:auto;
        height:auto;
      }
      .list{
        grid-template-columns: 1fr;
      }
      .search{
        min-width: min(520px, 92vw);
      }
    }
  </style>
</head>

<body>
  <div class="app" id="app">
    <!-- Sidebar -->
    <aside class="side" aria-label="Navegação">
      <div class="hd">
        <div class="brand">
          <div class="sigil" aria-hidden="true"></div>
          <div class="ttl">
            <h1>Sanctum Veritatis</h1>
            <small>SV.APP // APÊNDICES</small>
          </div>
        </div>
        <button class="iconbtn" id="btnSide" title="Alternar foco">≡</button>
      </div>

      <nav class="nav">
        <a class="active" href="#" data-section="aurora">
          <span>Operação: Aurora de Vidro</span>
          <span class="pill"><span class="dot"></span> Interno</span>
        </a>
        <a href="#" data-section="setentrional">
          <span>Operação: Setentrional</span>
          <span class="pill" style="border-color:rgba(255,255,255,.18); background:rgba(255,255,255,.03); color:rgba(255,255,255,.70);">
            Parcial
          </span>
        </a>
        <a href="#" data-section="policies">
          <span>Protocolos & Custódia</span>
          <span class="pill" style="border-color:rgba(255,255,255,.18); background:rgba(255,255,255,.03); color:rgba(255,255,255,.70);">
            Index
          </span>
        </a>
        <a href="#" data-section="vault">
          <span>SV.VAULT</span>
          <span class="pill" style="border-color:rgba(255,77,109,.30); background:rgba(255,77,109,.08); color:rgba(255,210,218,.95);">
            Restrito
          </span>
        </a>
      </nav>

      <div class="ft">
        <div class="mono" style="display:flex; justify-content:space-between; gap:10px;">
          <span class="dim">Acesso:</span>
          <span style="color:rgba(231,215,166,.95);">Nível 01 (leitura)</span>
        </div>
        <div class="mono" style="display:flex; justify-content:space-between; gap:10px;">
          <span class="dim">Sessão:</span>
          <span id="sess" style="color:rgba(231,215,166,.95);">SV-000000</span>
        </div>
      </div>
    </aside>

    <!-- Center list -->
    <main class="center" aria-label="Apêndices">
      <header class="topbar">
        <div class="title">
          <h2>Apêndices — Aurora de Vidro</h2>
          <div class="subtitle">
            Vík, Islândia // Janela: 72h // Código interno: HORDA<br/>
            Selecione um item para abrir o preview. Alguns anexos são “somente índice”.
          </div>
        </div>

        <div class="controls">
          <div class="search" role="search">
            <span class="kbd">⌕</span>
            <input id="q" placeholder="Buscar anexos (ID, tipo, nota, autor, caminho)..." autocomplete="off" />
            <span class="kbd">Ctrl K</span>
          </div>
        </div>
      </header>

      <div class="chipbar">
        <div class="chips" aria-label="Filtros">
          <button class="chip active" data-filter="all">Tudo</button>
          <button class="chip" data-filter="report">Relatórios</button>
          <button class="chip" data-filter="media">Mídia</button>
          <button class="chip" data-filter="transcript">Transcrições</button>
          <button class="chip" data-filter="protocol">Protocolos</button>
        </div>

        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <button class="btn ghost" id="btnReset">Limpar</button>
          <button class="btn" id="btnExport">Exportar índice</button>
        </div>
      </div>

      <section class="list" id="list" aria-label="Lista de apêndices">
        <!-- Items injected by JS -->
      </section>
    </main>

    <!-- Right preview -->
    <aside class="right" aria-label="Preview">
      <div class="preview-hd">
        <div>
          <h3 id="pvTitle">Nenhum apêndice selecionado</h3>
          <div class="subtitle" id="pvMeta">Selecione um item na lista para ver detalhes.</div>
        </div>
        <span class="badge gold" id="pvBadge">SV.APP</span>
      </div>

      <div class="preview" id="preview">
        <div class="box">
          <h4>Instrução</h4>
          <p class="mono">
            Esta área exibe o conteúdo liberado do apêndice. Itens com status “restrito” mostram apenas metadados e auditoria.
          </p>
        </div>

        <div class="box">
          <h4>Nota diegética</h4>
          <p class="mono dim">
            Você pode esconder chaves em <code>data-*</code>, comentários HTML, ou “checksum mismatch” em logs para guiar hacks.
          </p>
          <!-- hint: vault path looks wrong on purpose: /vault/hor_da/lexicon/ -->
        </div>
      </div>

      <div class="preview-actions">
        <div class="mono dim" id="pvHint">—</div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn ghost" id="btnCopyPath">Copiar caminho</button>
          <button class="btn" id="btnOpen">Abrir</button>
        </div>
      </div>
    </aside>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>
  </div>

  <script>
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    // Session
    $("#sess").textContent = "SV-" + Math.floor(Math.random()*1e6).toString().padStart(6,"0");

    // Data (Apêndices)
    const APPENDICES = [
      {
        id:"RPT-AV-00",
        title:"Relatório Preliminar (Redigido)",
        type:"report",
        status:"ok",
        clearance:"INTERNO",
        path:"/ops/aurora_vidro/anexos/RPT-AV-00.pdf",
        author:"Corvin / Kuroda",
        summary:"Versão redigida para circulação interna. 9 páginas. Cortes aplicados em descrições de padrão.",
        content:[
          "Trecho (resumo):",
          "O fenômeno apresenta repetição não compatível com ruído atmosférico.",
          "A cidade mantém funcionamento físico, porém está ausente de rotas e protocolos digitais comuns.",
          "Recomendação: reduzir exposição visual e impedir transcrição verbal do padrão."
        ].join("\n")
      },
      {
        id:"BRF-AV-01",
        title:"Briefing Inicial (Equipe-01)",
        type:"report",
        status:"warn",
        clearance:"INTERNO",
        path:"/ops/aurora_vidro/briefings/BRF-AV-01.html",
        author:"Hartmann / Saldanha",
        summary:"Documento de instruções + matriz de risco inicial, antes do primeiro MIA.",
        content:[
          "Conteúdo liberado:",
          "- Objetivos, regras críticas, hipótese Elemento Conhecimento.",
          "- Observação: exposição pode ocorrer por olhar e por entendimento.",
          "",
          "Nota: este arquivo costuma ser acessado via intranet (link interno)."
        ].join("\n")
      },
      {
        id:"LOG-AV-01",
        title:"Log de Rádio (Equipe-01) — Janela <20s",
        type:"transcript",
        status:"bad",
        clearance:"INTERNO",
        path:"/ops/aurora_vidro/anexos/LOG-AV-01.txt",
        author:"SV.AUDIT",
        summary:"Sequência curta de rádio onde a contaminação por olhar é identificada tarde demais.",
        content:[
          "[T+10.1s] HEATH: LARK está sorrindo.",
          "[T+11.0s] LARK: Eu só... entendi.",
          "[T+17.6s] SOLACE: Contaminação por olhar.",
          "[T+19.8s] MUIR: ...sorrindo.",
          "",
          "sv.audit: unit=EQUIPE-01 status=MIA window=<20s"
        ].join("\n")
      },
      {
        id:"EVD-AV-01",
        title:"Imagem (Baixa Luz) — Checksum Inconsistente",
        type:"media",
        status:"warn",
        clearance:"INTERNO",
        path:"/ops/aurora_vidro/anexos/EVD-AV-01.jpg",
        author:"SOLACE",
        summary:"Imagem em baixa luz. Ruído geométrico se comporta como borda semântica (não como pixel).",
        content:[
          "Preview indisponível (modo leitura, mídia bloqueada).",
          "",
          "sv.audit: CHECKSUM_MISMATCH em replicação.",
          "Nota: não ampliar em tela cheia; usar observador secundário."
        ].join("\n")
      },
      {
        id:"EVD-AV-02",
        title:"Áudio (Último Contato) — Ruído Repetitivo",
        type:"media",
        status:"warn",
        clearance:"INTERNO",
        path:"/ops/aurora_vidro/anexos/EVD-AV-02.wav",
        author:"MUIR",
        summary:"Ruído de fundo com padrão de repetição. Transcrição verbal proibida.",
        content:[
          "Preview indisponível (modo leitura, mídia bloqueada).",
          "Protocolo: ouvir apenas em janela de 5s, com observador secundário."
        ].join("\n")
      },
      {
        id:"PRT-AV-07",
        title:"Protocolo: Dupla Observação / Janelas de Exposição",
        type:"protocol",
        status:"ok",
        clearance:"INTERNO",
        path:"/policies/field/PRT-AV-07.pdf",
        author:"McRae",
        summary:"Procedimento de alternância, tempo máximo, e sinais precoces (sorriso, fixação, eco verbal).",
        content:[
          "Diretrizes:",
          "1) Exposição visual em janelas curtas (5–10s).",
          "2) Observador secundário mantém contato com a equipe (verbal + físico).",
          "3) Sorriso involuntário = recuo imediato + registro.",
          "4) Nunca repetir padrões em voz alta."
        ].join("\n")
      },
      {
        id:"IDX-AV-VAULT",
        title:"Índice de Itens no Cofre (não autorizado)",
        type:"report",
        status:"bad",
        clearance:"VAULT",
        path:"/vault/hor_da/lexicon/IDX.txt",
        author:"SV.VAULT",
        summary:"Apenas referência de existência. Conteúdo restrito. Pode conter 'lexicon' do padrão.",
        content:[
          "PERMISSÃO NEGADA.",
          "sv.vault: scope=hor_da/lexicon required=LEVEL_04",
          "",
          "Dica (sistema): o caminho parece ter sido escrito 'quebrado'."
        ].join("\n")
      }
    ];

    const STATUS_BADGE = {
      ok:   { label:"LIBERADO", cls:"ok" },
      warn: { label:"SENSÍVEL", cls:"warn" },
      bad:  { label:"RESTRITO", cls:"bad" }
    };

    let state = {
      filter: "all",
      query: "",
      selectedId: null
    };

    function toast(msg){
      const el = $("#toast");
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(() => el.classList.remove("show"), 1700);
    }

    function renderList(){
      const list = $("#list");
      list.innerHTML = "";

      const q = state.query.trim().toLowerCase();
      const filtered = APPENDICES.filter(a => {
        const typeOk = (state.filter === "all") || (a.type === state.filter);
        const hay = (a.id + " " + a.title + " " + a.type + " " + a.status + " " + a.path + " " + a.author + " " + a.summary).toLowerCase();
        const qOk = !q || hay.includes(q);
        return typeOk && qOk;
      });

      if(filtered.length === 0){
        const empty = document.createElement("div");
        empty.className = "item";
        empty.style.cursor = "default";
        empty.innerHTML = `
          <div class="row">
            <span class="badge gold">SV.APP</span>
            <span class="badge">0 resultados</span>
          </div>
          <h3>Nenhum apêndice encontrado</h3>
          <p>Tente remover filtros ou buscar por “AV”, “RPT”, “LOG”, “PRT”.</p>
        `;
        list.appendChild(empty);
        return;
      }

      for(const a of filtered){
        const el = document.createElement("article");
        el.className = "item" + (a.id === state.selectedId ? " active" : "");
        el.dataset.id = a.id;

        const st = STATUS_BADGE[a.status] || STATUS_BADGE.ok;
        el.innerHTML = `
          <div class="row">
            <span class="badge gold">${a.id}</span>
            <span class="badge ${st.cls}">${st.label}</span>
          </div>
          <h3>${a.title}</h3>
          <p>${a.summary}</p>
        `;
        el.addEventListener("click", () => select(a.id));
        list.appendChild(el);
      }
    }

    function setPreview(a){
      $("#pvTitle").textContent = a ? (a.id + " — " + a.title) : "Nenhum apêndice selecionado";
      $("#pvMeta").textContent  = a ? `${a.path} // ${a.clearance} // Autor: ${a.author}` : "Selecione um item na lista para ver detalhes.";

      const st = STATUS_BADGE[a?.status] || {label:"SV.APP", cls:"gold"};
      const b = $("#pvBadge");
      b.className = "badge " + (a ? (st.cls === "gold" ? "gold" : st.cls) : "gold");
      b.textContent = a ? st.label : "SV.APP";

      $("#pvHint").textContent = a
        ? (a.clearance === "VAULT" ? "Acesso insuficiente. Tente localizar credenciais ou caminho alternativo." : "Conteúdo liberado para leitura.")
        : "—";

      const pv = $("#preview");
      pv.innerHTML = "";

      if(!a){
        pv.innerHTML = `
          <div class="box">
            <h4>Instrução</h4>
            <p class="mono">Selecione um apêndice para abrir o preview.</p>
          </div>
        `;
        return;
      }

      pv.innerHTML = `
        <div class="box">
          <h4>Metadados</h4>
          <div class="mono">
            <div><span class="dim">ID:</span> <span style="color:rgba(231,215,166,.95)">${a.id}</span></div>
            <div><span class="dim">Tipo:</span> ${a.type}</div>
            <div><span class="dim">Status:</span> ${a.status}</div>
            <div><span class="dim">Sigilo:</span> ${a.clearance}</div>
            <div><span class="dim">Caminho:</span> <span id="pvPath" style="color:rgba(231,215,166,.95)">${a.path}</span></div>
          </div>
        </div>

        <div class="box">
          <h4>Conteúdo (preview)</h4>
          <div class="terminal">${escapeHtml(a.content)}</div>
        </div>

        <div class="box">
          <h4>Auditoria (trecho)</h4>
          <div class="terminal">${escapeHtml(makeAudit(a))}</div>
        </div>
      `;
    }

    function makeAudit(a){
      const base = [
        `[sv.audit] event=APPENDIX_INDEXED id=${a.id} path=${a.path}`,
        `[sv.audit] author=${a.author} clearance=${a.clearance} status=${a.status}`,
        a.status === "warn" ? `[sv.audit] note='sensível: exposição/replicação pode alterar evidência'` : null,
        a.status === "bad"  ? `[sv.vault] AccessDenied scope=${a.path} required=LEVEL_04` : null,
        `[sv.audit] hint='quando o padrão se repete, ele não está falhando — está treinando você.'`
      ].filter(Boolean);
      return base.join("\n");
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function select(id){
      state.selectedId = id;
      const a = APPENDICES.find(x => x.id === id);
      renderList();
      setPreview(a);
    }

    // Filters
    $$(".chip").forEach(ch => {
      ch.addEventListener("click", () => {
        $$(".chip").forEach(x => x.classList.remove("active"));
        ch.classList.add("active");
        state.filter = ch.dataset.filter;
        renderList();
      });
    });

    // Search
    const q = $("#q");
    q.addEventListener("input", () => {
      state.query = q.value;
      renderList();
    });

    window.addEventListener("keydown", (e) => {
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k"){
        e.preventDefault();
        q.focus();
      }
    });

    // Reset
    $("#btnReset").addEventListener("click", () => {
      state.query = "";
      q.value = "";
      state.filter = "all";
      $$(".chip").forEach(x => x.classList.toggle("active", x.dataset.filter === "all"));
      renderList();
      toast("Filtros limpos.");
    });

    // Export index (fake)
    $("#btnExport").addEventListener("click", () => {
      toast("Índice exportado (modo diegético).");
    });

    // Copy / Open
    $("#btnCopyPath").addEventListener("click", async () => {
      const a = APPENDICES.find(x => x.id === state.selectedId);
      if(!a) return toast("Selecione um apêndice primeiro.");
      try{
        await navigator.clipboard.writeText(a.path);
        toast("Caminho copiado.");
      }catch{
        toast("Sem permissão para copiar (navegador).");
      }
    });

    $("#btnOpen").addEventListener("click", () => {
      const a = APPENDICES.find(x => x.id === state.selectedId);
      if(!a) return toast("Selecione um apêndice primeiro.");
      if(a.clearance === "VAULT"){
        toast("PERMISSÃO NEGADA: requer LEVEL_04.");
        return;
      }
      toast("Abertura simulada: " + a.id);
    });

    // Sidebar section switching (diegético)
    $$(".nav a").forEach(a => {
      a.addEventListener("click", (e) => {
        e.preventDefault();
        $$(".nav a").forEach(x => x.classList.remove("active"));
        a.classList.add("active");

        const sec = a.dataset.section;
        if(sec === "aurora"){
          $(".title h2").textContent = "Apêndices — Aurora de Vidro";
          toast("Contexto: Aurora de Vidro");
        }else if(sec === "setentrional"){
          $(".title h2").textContent = "Apêndices — Setentrional";
          toast("Setentrional: índice parcial (placeholder)");
        }else if(sec === "policies"){
          $(".title h2").textContent = "Apêndices — Protocolos & Custódia";
          toast("Protocolos: index (placeholder)");
        }else if(sec === "vault"){
          $(".title h2").textContent = "SV.VAULT — Índice (Restrito)";
          toast("SV.VAULT: restrito.");
        }
      });
    });

    // Side toggle (visual)
    $("#btnSide").addEventListener("click", () => {
      toast("Foco alternado.");
      // efeito simples: rolar para topo do centro em telas menores
      $(".center").scrollIntoView({behavior:"smooth", block:"start"});
    });

    // Initial
    renderList();
    select("RPT-AV-00");
  </script>
</body>
</html>
