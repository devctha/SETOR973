<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINTECH :: FASE 07 - SINAPSE LABIR√çNTICA</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --grid-bg: #0a0a0a;
            --neon-blue: #00f3ff;
            --neon-orange: #ff9d00;
            --neon-red: #ff003c;
            --neon-green: #00ff41;
            --text-dim: #445;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }

        body {
            background-color: var(--bg);
            color: var(--neon-blue);
            font-family: 'Share Tech Mono', monospace;
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-rows: 60px 1fr 100px;
        }

        /* SCANLINES & CRT */
        body::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 100;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* HEADER */
        header {
            border-bottom: 2px solid var(--neon-blue);
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 20, 30, 0.8);
            z-index: 10;
        }

        .status-pill {
            border: 1px solid var(--neon-blue);
            padding: 5px 15px;
            font-size: 0.9rem;
            background: rgba(0, 243, 255, 0.1);
        }

        .warning { color: var(--neon-red); border-color: var(--neon-red); animation: blink 1s infinite; }

        /* MAIN LAYOUT */
        #interface {
            display: grid;
            grid-template-columns: 350px 1fr 300px; /* Controls | Grid | Data */
            gap: 10px;
            padding: 10px;
            height: 100%;
            overflow: hidden;
        }

        /* PANELS */
        .panel {
            border: 1px solid #333;
            background: rgba(10, 10, 10, 0.8);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: #111;
            padding: 5px 10px;
            border-bottom: 1px solid #333;
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
        }

        /* CONTROLS DISPLAY (Left) */
        #controls-panel { border-color: var(--neon-orange); }
        
        .key-map-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 20px;
            flex-grow: 1;
            align-items: center;
        }

        .key-bind {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            border: 1px solid #333;
            padding: 10px;
            background: #000;
        }

        .key-icon {
            width: 40px; height: 40px;
            border: 2px solid var(--neon-orange);
            color: var(--neon-orange);
            display: flex; align-items: center; justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .action-text { color: #fff; }

        .drift-timer {
            position: absolute; bottom: 0; left: 0; width: 100%;
            height: 5px; background: #333;
        }
        .drift-fill { height: 100%; background: var(--neon-orange); width: 100%; transition: width 1s linear; }

        /* LABYRINTH (Center) */
        #grid-container {
            background: var(--grid-bg);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--text-dim);
        }

        canvas { box-shadow: 0 0 20px rgba(0,0,0,0.8); }

        #dialogue-overlay {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 80%;
            background: rgba(0,0,0,0.9);
            border: 1px solid var(--neon-blue);
            padding: 15px;
            color: #fff;
            font-size: 1rem;
            display: none;
            text-shadow: 0 0 5px var(--neon-blue);
        }

        /* DATA STREAM (Right) */
        #data-panel { border-color: var(--neon-red); overflow: hidden; }
        
        #buffer-zone {
            flex-grow: 1;
            padding: 10px;
            font-size: 0.9rem;
            color: var(--text-dim);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .buffer-line { margin-top: 2px; }
        .buffer-line.highlight { color: var(--neon-red); font-weight: bold; text-shadow: 0 0 5px var(--neon-red); }

        #purge-input-container {
            padding: 10px;
            border-top: 1px solid var(--neon-red);
            background: #1a0505;
        }

        #purge-target { font-size: 1.2rem; color: #fff; letter-spacing: 5px; text-align: center; margin-bottom: 5px; }
        #purge-status { font-size: 0.8rem; color: var(--neon-red); text-align: center; }

        /* FOOTER (Spinal Stability) */
        #spinal-footer {
            display: flex;
            align-items: center;
            padding: 0 40px;
            background: #080808;
            border-top: 1px solid #333;
            gap: 20px;
        }

        .spinal-label { width: 150px; color: var(--neon-green); font-size: 1.1rem; }
        
        #spinal-track {
            flex-grow: 1;
            height: 30px;
            background: #222;
            border: 1px solid #444;
            position: relative;
            overflow: hidden;
        }

        #spinal-bar {
            height: 100%;
            width: 50%; /* Starts at 50% */
            background: linear-gradient(90deg, var(--neon-red) 0%, var(--neon-green) 50%, var(--neon-red) 100%);
            position: absolute; left: 0; top: 0; width: 100%;
            opacity: 0.3;
        }

        #spinal-cursor {
            position: absolute; top: 0; bottom: 0; width: 6px; background: #fff;
            left: 50%;
            box-shadow: 0 0 10px #fff;
            transition: left 0.1s linear;
        }

        #spinal-zones {
            position: absolute; top: 0; bottom: 0; left: 0; right: 0;
            background: linear-gradient(90deg, 
                rgba(255,0,0,0.5) 0%, 
                rgba(255,0,0,0.5) 20%, 
                transparent 20%, 
                transparent 80%, 
                rgba(255,0,0,0.5) 80%, 
                rgba(255,0,0,0.5) 100%);
            pointer-events: none;
        }

        /* GLITCH EFFECTS */
        .glitch-anim { animation: glitch-skew 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite; }
        @keyframes glitch-skew {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* OVERLAY MODAL */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 200;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        #overlay h1 { font-size: 3rem; color: var(--neon-blue); margin-bottom: 20px; }
        #overlay p { color: #fff; max-width: 600px; margin-bottom: 30px; line-height: 1.6; }
        #start-btn {
            background: transparent; border: 2px solid var(--neon-blue); color: var(--neon-blue);
            padding: 15px 40px; font-size: 1.5rem; font-family: inherit; cursor: pointer;
            transition: 0.3s;
        }
        #start-btn:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 20px var(--neon-blue); }

    </style>
</head>
<body>

    <div id="overlay">
        <h1>FASE 07: SINAPSE</h1>
        <p>A consci√™ncia foi transferida, mas o c√≥rtex motor est√° dessincronizado. 
           Os sinais neurais (WASD) sofrem "Drift" a cada 10 segundos.</p>
        <p style="color:var(--neon-orange)">1. CONTROLE MOTOR: Guie o ponto azul at√© a sa√≠da verde. Cuidado com as teclas mudando.</p>
        <p style="color:var(--neon-red)">2. BUFFER COGNITIVO: Digite as sequ√™ncias de letras para evitar sobrecarga.</p>
        <p style="color:var(--neon-green)">3. COLUNA ESPINHAL: Pressione ESPA√áO ritmicamente para manter o cursor no centro.</p>
        <button id="start-btn">INICIAR CALIBRA√á√ÉO</button>
    </div>

    <header>
        <div style="display:flex; gap:10px; align-items:center;">
            <span style="font-size:1.2rem; font-weight:bold;">SINTECH // F07</span>
            <span style="font-size:0.8rem; color:#666;">INTEGRIDADE MOTORA</span>
        </div>
        <div id="timer" class="status-pill">00:00:00</div>
        <div id="status-msg" class="status-pill warning" style="display:none;">NEURAL DRIFT DETECTADO</div>
    </header>

    <div id="interface">
        
        <!-- PAINEL DE CONTROLE (ESQUERDA) -->
        <div class="panel" id="controls-panel">
            <div class="panel-header">MAPEAMENTO NEURAL [DRIFT ATIVO]</div>
            <div class="key-map-container" id="key-map">
                <!-- Injected via JS -->
            </div>
            <div style="padding:10px; text-align:center; color:var(--neon-orange); font-size:0.8rem;">
                PR√ìXIMO RE-MAPEAMENTO EM:
            </div>
            <div class="drift-timer"><div class="drift-fill" id="drift-bar"></div></div>
        </div>

        <!-- LABIRINTO (CENTRO) -->
        <div class="panel" id="grid-container">
            <div class="panel-header" style="position:absolute; top:0; left:0; width:100%;">C√ìRTEX MOTOR // NAVIGATOR</div>
            <canvas id="game-canvas"></canvas>
            <div id="dialogue-overlay">
                <span style="color:var(--neon-blue); font-weight:bold;">VOID-WALKER:</span>
                <span id="dialogue-text">Minhas pernas... sinto est√°tica...</span>
            </div>
        </div>

        <!-- DADOS (DIREITA) -->
        <div class="panel" id="data-panel">
            <div class="panel-header">BUFFER COGNITIVO</div>
            <div id="buffer-zone">
                <!-- Lines added via JS -->
            </div>
            <div id="purge-input-container">
                <div style="font-size:0.7rem; color:#666; text-align:center;">DIGITE PARA EXPURGAR</div>
                <div id="purge-target">---</div>
                <div id="purge-status">BUFFER: 0%</div>
            </div>
        </div>

    </div>

    <!-- RODAP√â (ESTABILIDADE) -->
    <footer id="spinal-footer">
        <div class="spinal-label">SINCRONIA ESPINHAL</div>
        <div id="spinal-track">
            <div id="spinal-zones"></div>
            <div id="spinal-cursor"></div>
        </div>
        <div style="font-size:0.8rem; color:#666;">[ESPA√áO] PARA EQUILIBRAR</div>
    </footer>

<script>
    /**
     * SINTECH PHASE 07 - THE ENGINE
     * Difficulty: Extreme Multitasking
     */

    // --- GAME STATE ---
    const STATE = {
        running: false,
        time: 0,
        driftTime: 10, // Seconds until controls scramble
        driftTimer: 10,
        
        // MOTOR SYSTEM
        playerPos: { x: 1, y: 1 },
        gridSize: 20,
        controls: { 'W': 'UP', 'A': 'LEFT', 'S': 'DOWN', 'D': 'RIGHT' }, // Current mapping
        maze: [], // 0: path, 1: wall, 2: start, 3: end, 4: glitch trap
        cols: 25,
        rows: 20,
        
        // BUFFER SYSTEM
        bufferValue: 0, // 0 to 100
        currentPurgeCode: "",
        inputBuffer: "",
        
        // SPINAL SYSTEM
        spinalPos: 50, // 0 to 100, center is 50
        spinalVelocity: 0, // Natural decay direction
        spinalDecay: 0.3, // How fast it falls/rises randomly

        // DIALOGUE
        dialogueStep: 0,
    };

    // --- CONFIG ---
    const CANVAS = document.getElementById('game-canvas');
    const CTX = CANVAS.getContext('2d');
    const CELL_SIZE = 20;
    
    // --- AUDIO MOCK ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        const now = audioCtx.currentTime;
        if (type === 'move') {
            osc.frequency.setValueAtTime(200, now);
            osc.type = 'triangle';
            gain.gain.setValueAtTime(0.05, now);
            osc.start(); osc.stop(now + 0.05);
        } else if (type === 'bump') {
            osc.frequency.setValueAtTime(100, now);
            osc.type = 'sawtooth';
            gain.gain.setValueAtTime(0.1, now);
            osc.start(); osc.stop(now + 0.1);
        } else if (type === 'drift') {
            osc.frequency.setValueAtTime(800, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.5);
            gain.gain.setValueAtTime(0.2, now);
            osc.start(); osc.stop(now + 0.5);
        } else if (type === 'purge') {
            osc.frequency.setValueAtTime(1200, now);
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.1, now);
            osc.start(); osc.stop(now + 0.1);
        } else if (type === 'alarm') {
            osc.frequency.setValueAtTime(440, now);
            osc.type = 'square';
            gain.gain.setValueAtTime(0.2, now);
            osc.start(); osc.stop(now + 0.2);
        }
    }

    // --- MAZE GENERATION (Recursive Backtracker - Simplified) ---
    function generateMaze() {
        STATE.cols = Math.floor(CANVAS.width / CELL_SIZE);
        STATE.rows = Math.floor(CANVAS.height / CELL_SIZE);
        STATE.maze = Array(STATE.rows).fill().map(() => Array(STATE.cols).fill(1));

        function carve(x, y) {
            STATE.maze[y][x] = 0;
            const dirs = [[0, -2], [0, 2], [-2, 0], [2, 0]].sort(() => Math.random() - 0.5);
            for (let [dx, dy] of dirs) {
                const nx = x + dx, ny = y + dy;
                if (ny > 0 && ny < STATE.rows - 1 && nx > 0 && nx < STATE.cols - 1 && STATE.maze[ny][nx] === 1) {
                    STATE.maze[y + dy/2][x + dx/2] = 0;
                    carve(nx, ny);
                }
            }
        }
        
        carve(1, 1);
        STATE.maze[1][1] = 2; // Start
        STATE.playerPos = {x: 1, y: 1};
        
        // Ensure end is far away
        STATE.maze[STATE.rows-2][STATE.cols-2] = 3; // End

        // Add "Glitch Traps" (Reset position if touched)
        for(let i=0; i<15; i++) {
            let rx = Math.floor(Math.random() * (STATE.cols-2)) + 1;
            let ry = Math.floor(Math.random() * (STATE.rows-2)) + 1;
            if(STATE.maze[ry][rx] === 0) STATE.maze[ry][rx] = 4;
        }
    }

    // --- DRAWING ---
    function draw() {
        CTX.fillStyle = '#0a0a0a';
        CTX.fillRect(0, 0, CANVAS.width, CANVAS.height);

        for (let y = 0; y < STATE.rows; y++) {
            for (let x = 0; x < STATE.cols; x++) {
                const type = STATE.maze[y][x];
                if (type === 1) { // Wall
                    CTX.fillStyle = '#111';
                    CTX.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    CTX.strokeStyle = '#222';
                    CTX.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                } else if (type === 3) { // End
                    CTX.fillStyle = '#00ff41';
                    CTX.shadowBlur = 10; CTX.shadowColor = '#00ff41';
                    CTX.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    CTX.shadowBlur = 0;
                } else if (type === 4) { // Glitch
                    CTX.fillStyle = Math.random() > 0.5 ? '#ff003c' : '#000';
                    CTX.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                }
            }
        }

        // Player
        CTX.fillStyle = '#00f3ff';
        CTX.shadowBlur = 15; CTX.shadowColor = '#00f3ff';
        CTX.fillRect(STATE.playerPos.x * CELL_SIZE, STATE.playerPos.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
        CTX.shadowBlur = 0;
    }

    // --- LOGIC: NEURAL DRIFT ---
    function scrambleControls() {
        const actions = ['UP', 'DOWN', 'LEFT', 'RIGHT'];
        const keys = ['W', 'A', 'S', 'D'];
        
        // Fisher-Yates shuffle actions
        for (let i = actions.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [actions[i], actions[j]] = [actions[j], actions[i]];
        }

        keys.forEach((k, i) => {
            STATE.controls[k] = actions[i];
        });

        updateControlUI();
        playSound('drift');
        
        // Visual Glitch Effect on UI
        document.body.classList.add('glitch-anim');
        setTimeout(() => document.body.classList.remove('glitch-anim'), 300);
        
        document.getElementById('status-msg').style.display = 'block';
        setTimeout(() => document.getElementById('status-msg').style.display = 'none', 2000);
    }

    function updateControlUI() {
        const container = document.getElementById('key-map');
        container.innerHTML = '';
        
        const arrowMap = { 'UP': 'ü°°', 'DOWN': 'ü°£', 'LEFT': 'ü°†', 'RIGHT': 'ü°¢' };

        for (let key of ['W', 'A', 'S', 'D']) {
            const action = STATE.controls[key];
            const div = document.createElement('div');
            div.className = 'key-bind';
            div.innerHTML = `
                <div class="key-icon">${key}</div>
                <div class="action-text" style="color:${action === 'UP' ? '#0f0' : '#fff'}">
                    ${arrowMap[action]} ${action}
                </div>
            `;
            container.appendChild(div);
        }
    }

    // --- LOGIC: BUFFER / PURGE ---
    function generatePurgeCode() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        let code = "";
        for(let i=0; i<4; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
        STATE.currentPurgeCode = code;
        STATE.inputBuffer = "";
        document.getElementById('purge-target').innerText = code;
        
        // Add visual noise to buffer log
        const log = document.getElementById('buffer-zone');
        const line = document.createElement('div');
        line.className = 'buffer-line highlight';
        line.innerText = `>> OVERLOAD DETECTED: ${code}`;
        log.appendChild(line);
        log.scrollTop = log.scrollHeight;
    }

    // --- LOGIC: SPINAL STABILITY ---
    function updateSpine() {
        // Natural drift away from center
        STATE.spinalVelocity += (Math.random() - 0.5) * 2; 
        STATE.spinalPos += STATE.spinalVelocity * 0.1;
        
        // Boundaries
        if (STATE.spinalPos < 0) STATE.spinalPos = 0;
        if (STATE.spinalPos > 100) STATE.spinalPos = 100;

        // Visual
        const cursor = document.getElementById('spinal-cursor');
        cursor.style.left = STATE.spinalPos + '%';

        // Check Danger
        if (STATE.spinalPos < 10 || STATE.spinalPos > 90) {
            playSound('alarm');
            cursor.style.background = '#ff003c';
            STATE.bufferValue += 0.5; // Spinal fail causes cognitive load
        } else {
            cursor.style.background = '#fff';
        }
    }

    // --- INPUT HANDLING ---
    document.addEventListener('keydown', (e) => {
        if (!STATE.running) return;
        const key = e.key.toUpperCase();

        // MOTOR (WASD)
        if (['W', 'A', 'S', 'D'].includes(key)) {
            const action = STATE.controls[key];
            let dx = 0, dy = 0;
            if (action === 'UP') dy = -1;
            if (action === 'DOWN') dy = 1;
            if (action === 'LEFT') dx = -1;
            if (action === 'RIGHT') dx = 1;

            const nx = STATE.playerPos.x + dx;
            const ny = STATE.playerPos.y + dy;

            // Collision Check
            const cell = STATE.maze[ny][nx];
            if (cell !== 1) { // Not wall
                STATE.playerPos.x = nx;
                STATE.playerPos.y = ny;
                playSound('move');
                
                if (cell === 3) winGame(); // End
                if (cell === 4) { // Trap
                    STATE.playerPos = {x: 1, y: 1};
                    playSound('alarm');
                    STATE.bufferValue += 20; // Punishment
                }
            } else {
                playSound('bump');
            }
        }

        // SPINAL (Space)
        if (e.code === 'Space') {
            // Push towards center
            if (STATE.spinalPos < 50) STATE.spinalVelocity += 5;
            else STATE.spinalVelocity -= 5;
        }

        // COGNITIVE (Typing)
        if (key.length === 1 && key.match(/[A-Z]/)) {
            STATE.inputBuffer += key;
            if (STATE.inputBuffer.length > 4) STATE.inputBuffer = STATE.inputBuffer.slice(-4);
            
            if (STATE.inputBuffer === STATE.currentPurgeCode) {
                STATE.bufferValue = Math.max(0, STATE.bufferValue - 30);
                playSound('purge');
                const log = document.getElementById('buffer-zone');
                const line = document.createElement('div');
                line.className = 'buffer-line';
                line.style.color = '#00ff41';
                line.innerText = `>> PURGE SUCCESS`;
                log.appendChild(line);
                generatePurgeCode();
            }
        }
    });

    // --- GAME LOOP ---
    function update() {
        if (!STATE.running) return;

        // Timers
        STATE.time += 1/60;
        STATE.driftTimer -= 1/60;

        // Neural Drift Update
        document.getElementById('drift-bar').style.width = (STATE.driftTimer / STATE.driftTime * 100) + '%';
        if (STATE.driftTimer <= 0) {
            scrambleControls();
            STATE.driftTimer = STATE.driftTime;
        }

        // Buffer/Purge Logic (Increases over time)
        STATE.bufferValue += 0.05; // Base increment
        document.getElementById('purge-status').innerText = `BUFFER: ${Math.floor(STATE.bufferValue)}%`;
        document.getElementById('purge-status').style.width = STATE.bufferValue + '%';
        document.getElementById('purge-status').style.background = STATE.bufferValue > 80 ? '#ff003c' : '#333';

        if (STATE.bufferValue >= 100) {
            gameOver("SOBRECARGA COGNITIVA");
        }

        // Spinal Update
        updateSpine();

        // Dialogue Trigger (Simple narrative progress based on position)
        if (STATE.playerPos.x > STATE.cols / 2 && STATE.dialogueStep === 0) {
            showDialogue("O sinal... est√° limpando. Consigo sentir meus dedos.");
            STATE.dialogueStep++;
        }

        // Render Canvas
        draw();

        // HUD Timer
        const min = Math.floor(STATE.time / 60).toString().padStart(2,'0');
        const sec = Math.floor(STATE.time % 60).toString().padStart(2,'0');
        const ms = Math.floor((STATE.time % 1) * 100).toString().padStart(2,'0');
        document.getElementById('timer').innerText = `${min}:${sec}:${ms}`;

        requestAnimationFrame(update);
    }

    function showDialogue(text) {
        const box = document.getElementById('dialogue-overlay');
        document.getElementById('dialogue-text').innerText = text;
        box.style.display = 'block';
        setTimeout(() => box.style.display = 'none', 4000);
    }

    function winGame() {
        STATE.running = false;
        alert("INTEGRA√á√ÉO MOTORA COMPLETA.");
        // Redirect or show victory screen
        document.body.innerHTML = `
            <div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#000; color:#00f3ff; flex-direction:column;">
                <h1>CALIBRA√á√ÉO FINALIZADA</h1>
                <p>O hospedeiro responde com 99.8% de precis√£o.</p>
                <p>VOID-WALKER est√° pronto para caminhar.</p>
                <br>
                <a href="sintech_final.html" style="color:#fff; border:1px solid #fff; padding:10px;">INICIAR SEQU√äNCIA FINAL</a>
            </div>
        `;
    }

    function gameOver(reason) {
        STATE.running = false;
        document.body.innerHTML = `
            <div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#000; color:#ff003c; flex-direction:column;">
                <h1 style="font-size:4rem;">FALHA CR√çTICA</h1>
                <p>${reason}</p>
                <button onclick="location.reload()" style="margin-top:20px; padding:10px 20px; background:transparent; border:1px solid #ff003c; color:#ff003c; cursor:pointer;">REINICIAR SINAPSE</button>
            </div>
        `;
    }

    // --- INITIALIZATION ---
    function init() {
        CANVAS.width = document.getElementById('grid-container').offsetWidth;
        CANVAS.height = document.getElementById('grid-container').offsetHeight;
        
        generateMaze();
        scrambleControls(); // Initial scramble
        generatePurgeCode();
        
        // Populate fake log
        const log = document.getElementById('buffer-zone');
        log.innerHTML = `<div class="buffer-line">>> MOTOR_CORTEX_INIT... OK</div>
                         <div class="buffer-line">>> SPINAL_LINK... UNSTABLE</div>
                         <div class="buffer-line">>> CALIBRATING...</div>`;
    }

    document.getElementById('start-btn').addEventListener('click', () => {
        document.getElementById('overlay').style.display = 'none';
        init();
        STATE.running = true;
        update();
    });

    // Resize handling
    window.addEventListener('resize', () => {
        CANVAS.width = document.getElementById('grid-container').offsetWidth;
        CANVAS.height = document.getElementById('grid-container').offsetHeight;
        draw();
    });

</script>
</body>
</html>
