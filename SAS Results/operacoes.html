<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>S.A.S • OPERAÇÕES • ÍNDICE ATIVO</title>

  <style>
    :root{
      --bg0:#04030a;
      --bg1:#07081b;

      --violet:#a855f7;
      --blue:#38bdf8;
      --green:#22c55e;
      --red:#ef4444;
      --orange:#fb923c;

      --text:#dbeafe;
      --muted: rgba(219,234,254,.68);
      --grid: rgba(86, 88, 240, .10);

      --shadowV: 0 0 14px rgba(168,85,247,.35);
      --shadowB: 0 0 16px rgba(56,189,248,.22);
      --shadowG: 0 0 14px rgba(34,197,94,.22);
      --shadowR: 0 0 14px rgba(239,68,68,.20);
      --shadowO: 0 0 14px rgba(251,146,60,.16);

      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --scan-opacity: .11;
      --noise-opacity: .07;
      --flicker: .050;
      --shake: 0px;

      --fz: 13px;
      --fzSmall: 12px;
      --pad: 12px;
      --padSmall: 10px;
      --line: 1.55;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: var(--mono);
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 16% 12%, rgba(168,85,247,.12), transparent 62%),
        radial-gradient(900px 650px at 86% 22%, rgba(56,189,248,.10), transparent 60%),
        radial-gradient(900px 650px at 50% 92%, rgba(34,197,94,.08), transparent 62%),
        radial-gradient(1200px 900px at 50% 50%, rgba(239,68,68,.10), transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    .stage{
      position:relative;
      height:100%;
      width:100%;
      padding: clamp(12px, 2vw, 20px);
      display:grid;
      grid-template-rows: auto 1fr;
      gap: clamp(10px, 1.6vw, 16px);
      isolation:isolate;
      transform: translate3d(var(--shake), 0, 0);
    }

    /* CRT overlay */
    .crt::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(110% 100% at 50% 40%, rgba(255,255,255,.055), transparent 62%),
        linear-gradient(90deg, rgba(255,0,0,.03), transparent 22%, rgba(0,255,255,.02) 60%, transparent);
      mix-blend-mode: screen;
      opacity:.50;
      z-index: 3;
      filter: blur(.2px);
    }
    .crt::after{
      content:"";
      position:absolute;
      inset:-2px;
      pointer-events:none;
      background: linear-gradient(to bottom, rgba(0,0,0,.60) 50%, rgba(255,255,255,.04) 50%);
      background-size: 100% 2px;
      opacity: var(--scan-opacity);
      z-index: 4;
      animation: scanShift 10s linear infinite;
    }
    @keyframes scanShift{ 0%{transform:translateY(0)} 100%{transform:translateY(12px)} }

    .noise{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index: 5;
      opacity: var(--noise-opacity);
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='.6'/%3E%3C/svg%3E");
      background-size: 260px 260px;
      mix-blend-mode: overlay;
      animation: noiseDrift 3.6s steps(2) infinite;
    }
    @keyframes noiseDrift{
      0%{ transform: translate3d(0,0,0); }
      25%{ transform: translate3d(-7px,5px,0); }
      50%{ transform: translate3d(6px,-5px,0); }
      75%{ transform: translate3d(-4px,-2px,0); }
      100%{ transform: translate3d(0,0,0); }
    }

    .flicker{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:6;
      background: rgba(255,255,255, .02);
      opacity:0;
      animation: flicker 4.4s infinite;
    }
    @keyframes flicker{
      0%, 100%{ opacity: 0; }
      33%{ opacity: calc(var(--flicker) * 1.2); }
      34%{ opacity: 0; }
      58%{ opacity: calc(var(--flicker) * .8); }
      59%{ opacity: 0; }
      88%{ opacity: calc(var(--flicker) * 1.45); }
      89%{ opacity: 0; }
    }

    header{
      position:relative;
      padding: 14px 16px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(10,12,24,.72), rgba(5,6,10,.44));
      border: 1px solid rgba(168,85,247,.22);
      box-shadow: var(--shadowV), var(--shadowB);
      overflow:hidden;
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      flex-wrap:wrap;
    }
    .title{
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:900;
      font-size: 15px;
      color: #e9d5ff;
      text-shadow: var(--shadowV);
      line-height:1.1;
    }
    .sub{
      margin-top:6px;
      font-size: var(--fzSmall);
      color: rgba(219,234,254,.74);
      line-height:1.35;
      max-width: 110ch;
    }

    .pill{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(56,189,248,.24);
      background: rgba(2,6,23,.35);
      box-shadow: var(--shadowB);
      font-size: 12px;
      color: rgba(219,234,254,.82);
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: var(--violet);
      box-shadow: 0 0 14px rgba(168,85,247,.55);
    }

    main{
      position:relative;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(10,12,20,.66), rgba(3,6,18,.46));
      border: 1px solid rgba(168,85,247,.16);
      box-shadow: var(--shadowV), var(--shadowB), inset 0 0 0 1px rgba(34,197,94,.08);
      overflow:hidden;
      min-height: 0;
      display:grid;
      grid-template-rows: auto 1fr;
    }

    .gridOverlay{
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        linear-gradient(var(--grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size: 34px 34px;
      mask-image: radial-gradient(70% 60% at 50% 35%, #000 60%, transparent 100%);
      opacity:.55;
      z-index:0;
    }

    .toolbar{
      position:relative;
      z-index:1;
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      border-bottom: 1px solid rgba(56,189,248,.14);
    }
    .toolbar .k{
      font-size: 12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(219,234,254,.76);
    }
    .actions{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }

    .btn, .ghost, .field, .select{
      padding: 10px 12px;
      border-radius: 14px;
      font-family: var(--mono);
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size: 12px;
      user-select:none;
    }
    .btn{
      cursor:pointer;
      border: 1px solid rgba(251,146,60,.22);
      background: linear-gradient(180deg, rgba(251,146,60,.18), rgba(239,68,68,.10));
      color: #ffe4c7;
      box-shadow: var(--shadowO), var(--shadowR);
      transition: transform .08s ease, filter .15s ease;
    }
    .btn:hover{ filter: brightness(1.12); }
    .btn:active{ transform: translateY(1px); }

    .ghost{
      cursor:pointer;
      border: 1px solid rgba(56,189,248,.22);
      background: rgba(2,6,23,.22);
      color: rgba(219,234,254,.82);
      box-shadow: var(--shadowB);
    }

    .field, .select{
      border: 1px solid rgba(168,85,247,.22);
      background: rgba(2,6,23,.22);
      color: rgba(219,234,254,.82);
      min-width: min(320px, 90vw);
      text-transform:none;
      letter-spacing: 0;
      box-shadow: var(--shadowV);
    }
    .field::placeholder{ color: rgba(219,234,254,.40); }
    .select{ min-width: min(220px, 90vw); text-transform:uppercase; letter-spacing:.08em; }

    .wrap{
      position:relative;
      z-index:1;
      padding: 14px;
      min-height:0;
      overflow:auto;
      scrollbar-color: rgba(168,85,247,.55) rgba(2,6,23,.25);
      scrollbar-width: thin;
      display:grid;
      gap: 12px;
    }

    .card{
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.12);
      background: rgba(2,6,23,.25);
      box-shadow: inset 0 0 0 1px rgba(56,189,248,.06);
      overflow:hidden;
      min-width: 0;
    }

    .cardHead{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(56,189,248,.14);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      min-width: 0;
    }
    .cardHead .h{
      font-size: 12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(219,234,254,.82);
      min-width: 0;
    }

    .chips{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:7px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.12);
      background: rgba(2,6,23,.28);
      font-size: 12px;
      color: rgba(219,234,254,.62);
      white-space:nowrap;
    }
    .chip b{ color: rgba(219,234,254,.90); }

    .cardBody{ padding: var(--pad); min-width:0; }

    .block{
      border-radius: 14px;
      border: 1px solid rgba(168,85,247,.14);
      background: rgba(3,6,18,.44);
      box-shadow: var(--shadowV);
      overflow:hidden;
    }
    .blockTop{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(56,189,248,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .blockTop .label{
      font-size: 11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(219,234,254,.62);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-width: 0;
    }
    .blockTop .count{
      font-size: 12px;
      color: rgba(219,234,254,.72);
      white-space:nowrap;
    }
    .blockScroll{
      max-height: 58vh;
      overflow:auto;
      scrollbar-color: rgba(168,85,247,.55) rgba(2,6,23,.25);
      scrollbar-width: thin;
    }

    table{
      width:100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    th, td{
      text-align:left;
      padding: 10px;
      border-bottom: 1px solid rgba(56,189,248,.12);
      vertical-align:top;
      font-size: var(--fz);
      line-height: 1.45;
      color: rgba(219,234,254,.82);
      overflow-wrap:anywhere;
      word-break: break-word;
    }
    th{
      position: sticky;
      top: 0;
      z-index: 2;
      font-size: 12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(219,234,254,.72);
      background: rgba(2,6,23,.60);
      backdrop-filter: blur(6px);
    }
    tr:last-child td{ border-bottom:none; }

    .colCode{ width: 120px; }
    .colOrg{ width: 200px; }
    .colLoc{ width: 220px; }
    .colObj{ width: 42%; }
    .colAgents{ width: 110px; }
    .colRisk{ width: 120px; }

    .badge{
      display:inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.14);
      background: rgba(2,6,23,.22);
      color: rgba(219,234,254,.72);
      font-size: 12px;
      white-space:nowrap;
    }
    .badge.low{ border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.08); }
    .badge.med{ border-color: rgba(251,146,60,.28); background: rgba(251,146,60,.08); }
    .badge.high{ border-color: rgba(239,68,68,.28); background: rgba(239,68,68,.08); }

    .mono{
      font-family: var(--mono);
      padding: 1px 6px;
      border-radius: 8px;
      border: 1px solid rgba(56,189,248,.20);
      background: rgba(2,6,23,.25);
      color: rgba(219,234,254,.86);
      white-space: nowrap;
    }

    .pager{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 10px;
    }

    /* Compact mode */
    body.compact{
      --fz: 12px;
      --fzSmall: 11px;
      --pad: 10px;
      --padSmall: 9px;
      --line: 1.45;
    }

    /* Intro */
    .intro{
      position:fixed;
      inset:0;
      z-index:50;
      display:grid;
      place-items:center;
      padding: 16px;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(7px);
    }
    .introCard{
      width:min(980px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(168,85,247,.26);
      background: linear-gradient(180deg, rgba(5,6,10,.90), rgba(3,6,18,.64));
      box-shadow:
        0 0 0 1px rgba(56,189,248,.10) inset,
        0 0 48px rgba(168,85,247,.18),
        0 0 56px rgba(56,189,248,.12);
      overflow:hidden;
      position:relative;
    }
    .introTop{
      padding: 16px 16px 10px;
      border-bottom: 1px solid rgba(56,189,248,.14);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      flex-wrap:wrap;
    }
    .introTop .h{
      letter-spacing:.16em;
      text-transform:uppercase;
      font-weight:900;
      color: #e9d5ff;
      text-shadow: var(--shadowV);
      font-size: 13px;
    }
    .introTop .s{
      margin-top:6px;
      font-size: 12px;
      color: rgba(219,234,254,.65);
      line-height:1.35;
      max-width: 110ch;
    }
    .typebox{
      padding: 14px 16px 16px;
      white-space: pre-wrap;
      line-height:1.55;
      color: rgba(219,234,254,.78);
      font-size: 12px;
      min-height: 200px;
      max-height: min(52vh, 560px);
      overflow:auto;
    }
    .introActions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      padding: 0 16px 16px;
    }
    .kbd{
      font-size:12px;
      color: rgba(219,234,254,.62);
    }
    .kbd code{
      font-family: var(--mono);
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(251,146,60,.25);
      background: rgba(251,146,60,.08);
      color: #ffe4c7;
    }
  </style>
</head>

<body class="compact">
  <div class="stage crt" id="stage">
    <div class="gridOverlay" aria-hidden="true"></div>
    <div class="noise" aria-hidden="true"></div>
    <div class="flicker" aria-hidden="true"></div>

    <header>
      <div class="top">
        <div>
          <div class="title">S.A.S / Índice • Operações</div>
          <div class="sub">
            Catálogo de operações paranormais <span class="warn">ativas</span> (mínimo: <span class="ok">1233+</span>).<br/>
            Campos: organização • localização • objetivo • agentes designados • risco.
          </div>
        </div>
        <div class="pill"><span class="dot"></span><span>FILE: OPS_INDEX • STATUS: ACTIVE</span></div>
      </div>
    </header>

    <main>
      <div class="toolbar">
        <div class="k">FILTER / SEARCH</div>
        <div class="actions">
          <input class="field" id="q" placeholder="Buscar (código, org, cidade, objetivo)..." />
          <select class="select" id="risk">
            <option value="">RISCO: TODOS</option>
            <option value="BAIXO">RISCO: BAIXO</option>
            <option value="MÉDIO">RISCO: MÉDIO</option>
            <option value="ALTO">RISCO: ALTO</option>
            <option value="CRÍTICO">RISCO: CRÍTICO</option>
          </select>
          <button class="ghost" id="btnClear" type="button">Limpar</button>
          <button class="btn" id="btnRead" type="button">Modo: COMPACTO</button>
        </div>
      </div>

      <div class="wrap" id="scrollArea">
        <section class="card">
          <div class="cardHead">
            <div class="h">Lista (1233+)</div>
            <div class="chips">
              <span class="chip"><b>Status</b> ativo</span>
              <span class="chip"><b>Busca</b> instantânea</span>
              <span class="chip"><b>Paginação</b> 100/pg</span>
            </div>
          </div>

          <div class="cardBody">
            <div class="block">
              <div class="blockTop">
                <div class="label">Operações ativas (rolagem interna)</div>
                <div class="count" id="count">—</div>
              </div>

              <div class="blockScroll">
                <table id="tbl">
                  <thead>
                    <tr>
                      <th class="colCode">Código</th>
                      <th class="colOrg">Organização</th>
                      <th class="colLoc">Localização</th>
                      <th class="colObj">Objetivo</th>
                      <th class="colAgents">Agentes</th>
                      <th class="colRisk">Risco</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

            <div class="pager">
              <div class="kbd">
                Navegação: <code>&lt;</code>/<code>&gt;</code> página • <code>/</code> foco na busca • <code>Esc</code> limpar.
              </div>
              <div class="actions">
                <button class="ghost" id="prev" type="button">&lt; Anterior</button>
                <span class="pill"><span class="dot"></span><span id="page">PÁG 1</span></span>
                <button class="ghost" id="next" type="button">Próxima &gt;</button>
              </div>
            </div>

          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Intro -->
  <div class="intro" id="intro" role="dialog" aria-modal="true" aria-label="Introdução Operações">
    <div class="introCard">
      <div class="introTop">
        <div>
          <div class="h">SARCOPHAGUS / OPEN FILE</div>
          <div class="s">
            Índice de operações ativas (1233+). Use a busca para filtrar por organização/local/objetivo e o seletor para risco.<br/>
            Atalho: <code>R</code> alterna Compacto/Legível.
          </div>
        </div>
        <div class="pill"><span class="dot"></span><span>MODE: OPS</span></div>
      </div>
      <div class="typebox" id="typebox"></div>
      <div class="introActions">
        <button class="btn" id="btnEnter" type="button">Entrar</button>
        <div class="kbd">Atalhos: <code>Enter</code> entrar • <code>R</code> leitura • <code>/</code> busca</div>
      </div>
    </div>
  </div>

  <script>
    const intro = document.getElementById("intro");
    const typebox = document.getElementById("typebox");

    const q = document.getElementById("q");
    const risk = document.getElementById("risk");
    const btnClear = document.getElementById("btnClear");
    const btnEnter = document.getElementById("btnEnter");
    const btnRead = document.getElementById("btnRead");

    const tbody = document.querySelector("#tbl tbody");
    const count = document.getElementById("count");
    const pageEl = document.getElementById("page");
    const prev = document.getElementById("prev");
    const next = document.getElementById("next");

    let compact = true;
    let page = 1;
    const PER_PAGE = 100;

    // ===== DATA =====
    // Estrutura esperada:
    // { code, org, loc, obj, agents, risk }
    //
    // Por enquanto, gera 1233 registros fictícios para testar UI.
    // Substitua OPS = [...] com seus dados reais (CSV/JSON).
    const ORGS = [
      "Ordo Realitas","Sanctum Veritatis","Companhia 978","Fundação Prometheus","Shadow Company","Caçadores",
      "Conselho Escarlate","DRACONIA","Esquadra 0","Inexo 034","Setentrional Bureau","Arquivistas do Véu",
      "Departamento Mnemônico","Coalizão de Selo","Consórcio Helix","Núcleo Umbra"
    ];

    const LOCAIS = [
      "São Paulo, BR","Rio de Janeiro, BR","Recife, BR","Brasília, BR","Manaus, BR","Porto Alegre, BR",
      "Lisboa, PT","Porto, PT","Madrid, ES","Paris, FR","Berlim, DE","Praga, CZ",
      "Moscou, RU","Varsóvia, PL","Istambul, TR","Cairo, EG",
      "Cidade do México, MX","Bogotá, CO","Buenos Aires, AR","Santiago, CL",
      "Nova York, EUA","Chicago, EUA","Los Angeles, EUA","Londres, UK","Dublin, IE",
      "Tóquio, JP","Seul, KR","Hong Kong, CN","Singapura, SG","Sydney, AU"
    ];

    const OBJ = [
      "Interditar zona e conter eco residual.",
      "Extrair ativo (relíquia/testemunha) com cadeia de custódia intacta.",
      "Neutralizar culto e recuperar artefatos.",
      "Mapear anomalia e reduzir exposição civil.",
      "Executar quarentena e limpeza semântica pós-incidente.",
      "Investigar desaparecimentos com assinatura de membrana.",
      "Selar passagem instável (porta/fenda) e monitorar recorrência.",
      "Negociar cessar-fogo interfacções e remover gatilhos meméticos."
    ];

    const RISKS = ["BAIXO","MÉDIO","ALTO","CRÍTICO"];

    function pad4(n){ return String(n).padStart(4,"0"); }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function riskBadge(r){
      const cls = (r==="BAIXO") ? "low" : (r==="MÉDIO") ? "med" : "high";
      // CRÍTICO também fica "high" (vermelho)
      return `<span class="badge ${cls}">${r}</span>`;
    }

    function buildFakeOps(total=1233){
      const out = [];
      for (let i=1; i<=total; i++){
        const org = pick(ORGS);
        const loc = pick(LOCAIS);
        const obj = pick(OBJ);
        const agents = 2 + Math.floor(Math.random()*19); // 2..20
        const risk = (Math.random() < 0.08) ? "CRÍTICO"
                    : (Math.random() < 0.28) ? "ALTO"
                    : (Math.random() < 0.60) ? "MÉDIO"
                    : "BAIXO";
        out.push({
          code: "OP-" + pad4(i),
          org, loc, obj, agents, risk
        });
      }
      return out;
    }

    const OPS = buildFakeOps(1233);

    // ===== FILTER + PAGINATION =====
    function getFiltered(){
      const term = q.value.trim().toLowerCase();
      const r = risk.value;
      return OPS.filter(o => {
        if (r && o.risk !== r) return false;
        if (!term) return true;
        const hay = (o.code + " " + o.org + " " + o.loc + " " + o.obj).toLowerCase();
        return hay.includes(term);
      });
    }

    function clampPage(maxPage){
      if (page < 1) page = 1;
      if (page > maxPage) page = maxPage;
    }

    function render(){
      const list = getFiltered();
      const maxPage = Math.max(1, Math.ceil(list.length / PER_PAGE));
      clampPage(maxPage);

      const start = (page - 1) * PER_PAGE;
      const slice = list.slice(start, start + PER_PAGE);

      tbody.innerHTML = slice.map(o => `
        <tr>
          <td><span class="mono">${o.code}</span></td>
          <td>${o.org}</td>
          <td>${o.loc}</td>
          <td>${o.obj}</td>
          <td>${o.agents}</td>
          <td>${riskBadge(o.risk)}</td>
        </tr>
      `).join("");

      count.textContent = `${slice.length} exibidas • ${list.length} filtradas • ${OPS.length} no índice`;
      pageEl.textContent = `PÁG ${page} / ${maxPage}`;

      prev.disabled = (page <= 1);
      next.disabled = (page >= maxPage);
      prev.style.opacity = prev.disabled ? .55 : 1;
      next.style.opacity = next.disabled ? .55 : 1;
    }

    function updateReadMode(){
      document.body.classList.toggle("compact", compact);
      btnRead.textContent = "Modo: " + (compact ? "COMPACTO" : "LEGÍVEL");
    }

    function closeIntro(){
      intro.style.display = "none";
      q.focus();
    }

    const boot = [
      "[S.A.S] file: operacoes.html",
      "[S.A.S] index: active operations (1233+)",
      "",
      "CAMPOS: ORG • LOCAL • OBJETIVO • AGENTES • RISCO",
      "FILTROS: TEXTO + RISCO",
      "",
      "Pressione ENTER."
    ];

    function typeBoot(){
      typebox.textContent = "";
      let i = 0;
      const tick = () => {
        if (i >= boot.length) return;
        typebox.textContent += boot[i] + "\n";
        typebox.scrollTop = typebox.scrollHeight;
        i++;
        setTimeout(tick, 25 + Math.random()*80);
      };
      tick();
    }

    // events
    q.addEventListener("input", () => { page = 1; render(); });
    risk.addEventListener("change", () => { page = 1; render(); });

    btnClear.addEventListener("click", () => { q.value=""; risk.value=""; page=1; render(); q.focus(); });
    btnRead.addEventListener("click", () => { compact = !compact; updateReadMode(); });

    prev.addEventListener("click", () => { page--; render(); });
    next.addEventListener("click", () => { page++; render(); });

    window.addEventListener("keydown", (e) => {
      if (intro.style.display !== "none") {
        if (e.key === "Enter") closeIntro();
        return;
      }
      if (e.key === "/") { e.preventDefault(); q.focus(); }
      if (e.key.toLowerCase() === "r") { compact = !compact; updateReadMode(); }
      if (e.key === "Escape") { q.value=""; risk.value=""; page=1; render(); q.blur(); }
      if (e.key === "ArrowLeft") { if (!prev.disabled) { page--; render(); } }
      if (e.key === "ArrowRight") { if (!next.disabled) { page++; render(); } }
    });

    btnEnter.addEventListener("click", closeIntro);

    // init
    typeBoot();
    render();
    updateReadMode();
  </script>
</body>
</html>
